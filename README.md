# 智能排课系统 (Smart Schedule System)

一个基于 Python (Flask) 和 Google OR-Tools 开发的智能排课系统，专为中小学设计。支持自动化排课、可视化手动微调、高级约束配置及排课数据统计。

## ✨ 核心功能

### 🚀 智能自动排课
*   **OR-Tools 算法驱动**：基于 Google OR-Tools 约束编程，自动处理多维度冲突。
*   **多线程求解**：支持多线程并行计算，大幅提升排课效率 `v2.0`。
*   **灵活配置**：支持自定义每日/每周课时容量（默认 9 节/天）。

### 🖥️ 现代化交互体验 `New`
*   **⚡ 实时冲突反馈**：拖拽课程时，若目标位置老师已有课，格子立即变红并提示冲突详情。
*   **↩️ 撤销/重做 (Undo/Redo)**：支持 Ctrl+Z/Ctrl+Y 快捷键，误操作随时回滚。
*   **🤖 智能推荐**：单击课程，自动高亮所有可行的空闲时间槽。
*   **📥 Excel 一键导入**：支持上传 Excel 文件批量导入科目、老师和教室配置，告别手动录入。

### ⚙️ 高级约束管理
*   **可视化禁排**：在网格中直接点击，设置老师的禁排时段（如周五下午）。
*   **资源限制**：支持设置教室（如音乐室、实验室）的容量限制，防止资源超排。

### 📊 统计与代课
*   **数据看板**：内置 Chart.js 图表，直观展示每位老师的周课时工作量。
*   **智能代课**：处理请假请求，自动推荐同科目空闲老师，支持课程互换或转自习。

## 🛠️ 技术栈

*   **后端**: Python 3.8+, Flask 2.0+
*   **算法**: Google OR-Tools (CP-SAT Solver)
*   **前端**: HTML5, Bootstrap 5, JavaScript (ES6+), Chart.js
*   **数据处理**: Pandas, OpenPyxl

## 🚀 快速开始

### 1. 环境准备
确保已安装 Python 3.8 或更高版本。

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

核心依赖包：
```text
flask
flask-cors
ortools
pandas
openpyxl
```

### 3. 运行应用

```bash
python app.py
```

启动后，打开浏览器访问：`http://127.0.0.1:5000`

## 📖 使用指南

1.  **快速初始化**: 点击侧边栏 **📝** (设置) -> **“从 Excel 导入配置”**，上传符合模板的 Excel 文件。
2.  **高级约束**: 点击 **⚙️** (高级设置) 设置特定老师的“不排课时间”。
3.  **生成课表**: 点击 "🚀 生成/重置" 按钮。
4.  **调整优化**: 
    *   **拖拽**：直接拖动课程进行微调（注意观察红色冲突提示）。
    *   **撤销**：按 `Ctrl+Z` 撤销上一步操作。
    *   **推荐**：点击课程查看绿色的推荐位置。
5.  **导出交付**: 点击 "📥 导出 Excel" 下载最终的班级课表或老师课表。

## 📝 目录结构

*   `app.py`: Flask 后端 API 与路由控制。
*   `normal.py`: CSP 排课算法核心实现 (OR-Tools)。
*   `substitution.py`: 代课、调课及冲突检测逻辑。
*   `storage.py`: JSON 文件持久化存储。
*   `templates/index.html`: 前端单页应用 (包含所有 UI/UX 逻辑)。

---
*Created by LEO - 得鹿山智能排课系统*
